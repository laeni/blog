<%#
 评论实现.

 局部变量:
  isIndex: 是否是首页,首页页直接嵌入归档,但是首页的显示方式与独立的归档页显示方式不同
%>

<% if (!isIndex && theme.leancloud && theme.leancloud.enable && page.comments){ %>
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<%- js('js/Valine.min') %>
<script>
  new Valine({
    el: "#vcomments",
    serverURLs: "https://api.leancloud.laeni.cn",
    appId: "<%- theme.leancloud.app_id %>",
    appKey: "<%- theme.leancloud.app_key %>",
    path: "<%- theme.valine.baseUrl + url_for(page.path) %>",  // 当前文章页路径，用于区分不同的文章页，以保证正确读取该文章页下的评论列表
    avatar: "<%- theme.valine.avatar %>",
    placeholder: "<%- theme.valine.placeholder %>",
    meta: ['nick', 'mail'],                                    // 评论者相关属性
    recordIP: true,
    enableQQ: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>
<% } %>
